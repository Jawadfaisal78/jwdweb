<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>S.A Samad Enterprises Billing System</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1

1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.23/jspdf.plugin.autotable.min.js"></script>
<style>
/* ===== GLOBAL STYLES ===== */
:root {
    --primary: #003E7E;
    --secondary: #0078D7;
    --light: #f3f6fa;
    --dark: #1a1a1a;
    --text: #333;
    --text-light: #eee;
}
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--light);
    margin: 0;
    padding: 0;
    color: var(--text);
    transition: all 0.3s;
}
body.dark-mode {
    background: var(--dark);
    color: var(--text-light);
}

/* ===== LOGIN SCREEN ===== */
#loginScreen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex; justify-content: center; align-items: center;
    z-index: 9999;
}
.login-box {
    background: white; padding: 30px; border-radius: 12px; width: 300px; text-align: center;
    box-shadow: 0 5px 20px rgba(0,0,0,0.3);
}
.login-box input { width: 100%; margin: 10px 0; padding: 12px; border: 1px solid #ccc; border-radius: 6px; }
.login-box button { width: 100%; padding: 12px; background: var(--secondary); color: white; border: none; border-radius: 6px; cursor: pointer; }

/* ===== HEADER ===== */
header {
    background: linear-gradient(90deg, var(--primary), var(--secondary));
    color: white;
    padding: 20px;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    border-bottom-left-radius: 12px;
    border-bottom-right-radius: 12px;
}
header h1 { margin: 0; font-size: 1.8em; }

/* ===== MENU ===== */
.menu {
    display: flex; justify-content: center; flex-wrap: wrap; gap: 10px; margin-top: 15px;
}
.menu button, .load-label {
    background: var(--secondary); color: white; border: none; padding: 10px 16px;
    border-radius: 6px; cursor: pointer; font-size: 14px; transition: 0.3s;
}
.menu button:hover, .load-label:hover { background: #005fa3; transform: translateY(-2px); }
#loadFile { display: none; }

/* ===== DASHBOARD ===== */
.dashboard {
    display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px;
    margin: 20px; max-width: 900px;
}
.card {
    background: white; padding: 15px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    text-align: center; font-size: 14px;
}
body.dark-mode .card { background: #2a2a2a; }
.card h3 { margin: 0; color: var(--primary); font-size: 1.4em; }

/* ===== MAIN ===== */
main { display: flex; flex-direction: column; align-items: center; padding: 25px 10px; gap: 20px; }
.entry-form, .entries { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); width: 100%; max-width: 900px; }
body.dark-mode .entry-form, body.dark-mode .entries { background: #2a2a2a; }

/* ===== FILTERS ===== */
.filters {
    display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;
}
.filters input, .filters select { padding: 8px; border: 1px solid #ccc; border-radius: 6px; }

/* ===== TABLE ===== */
table { width: 100%; border-collapse: collapse; font-size: 14px; }
th, td { border-bottom: 1px solid #ddd; text-align: left; padding: 10px; }
th { background: #EAF1FB; color: var(--primary); }
tr:nth-child(even) { background: #f9f9f9; }
tr:hover { background: #eef6ff; }
body.dark-mode tr:nth-child(even) { background: #333; }
body.dark-mode tr:hover { background: #444; }
.editBtn, .deleteBtn { padding: 5px 8px; margin: 0 3px; border: none; border-radius: 4px; cursor: pointer; }
.editBtn { background: #5cb85c; color: white; }
.deleteBtn { background: #d9534f; color: white; }

/* ===== RESULT ===== */
.billing-result { background: #eaf6ff; border-left: 4px solid var(--secondary); padding: 12px; margin-top: 15px; border-radius: 6px; display: none; }

/* ===== FOOTER ===== */
footer { background: var(--primary); color: white; text-align: center; padding: 12px; margin-top: 30px; }

/* ===== DARK MODE TOGGLE ===== */
#darkModeToggle { position: fixed; bottom: 20px; right: 20px; background: var(--secondary); color: white; border: none; width: 50px; height: 50px; border-radius: 50%; font-size: 20px; cursor: pointer; box-shadow: 0 2px 10px rgba(0,0,0,0.3); }

/* ===== RESPONSIVE ===== */
@media (max-width: 768px) {
    .menu { flex-direction: column; }
    .filters { flex-direction: column; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div id="loginScreen">
    <div class="login-box">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
        <p style="font-size:12px; margin-top:10px; color:#666;">Hint: Mian / 4150</p>
    </div>
</div>

<header>
    <h1>S.A Samad Enterprises Billing System</h1>
    <div class="menu">
        <label class="load-label" for="loadFile">Load Entries</label>
        <input type="file" id="loadFile">
        <button id="addBillingEntryBtn">Add Entry</button>
        <button id="calculateBtn">Calculate Total</button>
        <button id="exportBtn">Export Invoice</button>
        <button onclick="toggleDarkMode()">Dark Mode</button>
    </div>
</header>

<main>
    <!-- DASHBOARD -->
    <div class="dashboard">
        <div class="card"><h3 id="totalClients">0</h3><p>Total Clients</p></div>
        <div class="card"><h3 id="thisMonth">₨0 PKR</h3><p>This Month</p></div>
        <div class="card"><h3 id="totalBilled">₨0 PKR</h3><p>Total Billed</p></div>
    </div>

    <!-- ENTRY FORM -->
    <section class="entry-form">
        <h2 id="formTitle">Add Company Billing Entry</h2>
        <input type="text" id="billingCompany" placeholder="Company Name">
        <input type="month" id="billingMonth">
        <input type="date" id="billingDate">
        <input type="number" id="billingAmount" placeholder="Total Amount">
        <input type="number" id="billingTotalDays" placeholder="Total Days in Month" value="30">
        <input type="number" id="billingDays" placeholder="Billed Days">
        <button id="saveEntryBtn">Save Entry</button>
        <button id="cancelEditBtn" style="display:none; background:#999;">Cancel</button>
    </section>

    <!-- ENTRIES TABLE -->
    <section class="entries">
        <h2>Billing Entries</h2>
        <div class="filters">
            <input type="text" id="searchInput" placeholder="Search Company..." onkeyup="filterTable()">
            <select id="monthFilter" onchange="filterTable()">
                <option value="">All Months</option>
            </select>
        </div>
        <table id="billingTable">
            <thead>
                <tr>
                    <th>Company</th>
                    <th>Month</th>
                    <th>Date</th>
                    <th>Total Amount</th>
                    <th>Billed Days</th>
                    <th>Per Day</th>
                    <th>Billed Amount</th>
                    <th>Action</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
        <div id="billingResult" class="billing-result"></div>
    </section>
</main>

<footer>
    <p>S.A Samad Enterprises Pvt LTD 2025 - All amounts in PKR</p>
</footer>

<button id="darkModeToggle" onclick="toggleDarkMode()">Dark Mode</button>

<script>
let billingEntries = JSON.parse(localStorage.getItem('billingEntries')) || [];
let editIndex = -1;

// LOGIN
function login() {
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    if (user === 'Mian' && pass === '4150') {
        document.getElementById('loginScreen').style.display = 'none';
        loadApp();
    } else {
        alert('Invalid credentials!');
    }
}

function loadApp() {
    updateDashboard();
    updateBillingTable();
    populateMonthFilter();
}

function saveToStorage() {
    localStorage.setItem('billingEntries', JSON.stringify(billingEntries));
    updateDashboard();
}

// DASHBOARD - PKR
function updateDashboard() {
    const uniqueClients = new Set(billingEntries.map(e => e.company)).size;
    const currentMonth = new Date().toISOString().slice(0,7);
    const thisMonthTotal = billingEntries.filter(e => e.month === currentMonth).reduce((sum, e) => sum + e.billedAmount, 0);
    const totalBilled = billingEntries.reduce((sum, e) => sum + e.billedAmount, 0);

    document.getElementById('totalClients').textContent = uniqueClients;
    document.getElementById('thisMonth').textContent = `₨${thisMonthTotal.toFixed(2)} PKR`;
    document.getElementById('totalBilled').textContent = `₨${totalBilled.toFixed(2)} PKR`;
}

function populateMonthFilter() {
    const months = [...new Set(billingEntries.map(e => e.month))].sort();
    const select = document.getElementById('monthFilter');
    select.innerHTML = '<option value="">All Months</option>';
    months.forEach(m => {
        const opt = document.createElement('option');
        opt.value = m; 
        opt.textContent = new Date(m + '-01').toLocaleString('default', { month: 'long', year: 'numeric' });
        select.appendChild(opt);
    });
}

// SAVE ENTRY
document.getElementById('saveEntryBtn').addEventListener('click', () => {
    const company = document.getElementById('billingCompany').value.trim();
    const month = document.getElementById('billingMonth').value;
    const date = document.getElementById('billingDate').value;
    const totalAmount = parseFloat(document.getElementById('billingAmount').value) || 0;
    const totalDays = parseInt(document.getElementById('billingTotalDays').value) || 30;
    const billedDays = parseInt(document.getElementById('billingDays').value) || 0;

    if(!company || !month || !date || totalAmount <= 0 || billedDays <= 0) {
        alert("Please fill all fields correctly.");
        return;
    }

    const perDay = totalAmount / totalDays;
    const billedAmount = perDay * billedDays;

    const entry = {company, month, date, totalAmount, totalDays, billedDays, perDay, billedAmount};

    if (editIndex >= 0) {
        billingEntries[editIndex] = entry;
        editIndex = -1;
        document.getElementById('formTitle').textContent = 'Add Company Billing Entry';
        document.getElementById('cancelEditBtn').style.display = 'none';
    } else {
        billingEntries.push(entry);
    }

    clearForm();
    saveToStorage();
    updateBillingTable();
    populateMonthFilter();
});

function clearForm() {
    ['billingCompany','billingMonth','billingDate','billingAmount','billingDays'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('billingTotalDays').value = '30';
}

document.getElementById('cancelEditBtn').addEventListener('click', () => {
    editIndex = -1;
    clearForm();
    document.getElementById('formTitle').textContent = 'Add Company Billing Entry';
    document.getElementById('cancelEditBtn').style.display = 'none';
});

function editEntry(index) {
    const e = billingEntries[index];
    document.getElementById('billingCompany').value = e.company;
    document.getElementById('billingMonth').value = e.month;
    document.getElementById('billingDate').value = e.date;
    document.getElementById('billingAmount').value = e.totalAmount;
    document.getElementById('billingTotalDays').value = e.totalDays;
    document.getElementById('billingDays').value = e.billedDays;

    editIndex = index;
    document.getElementById('formTitle').textContent = 'Edit Entry';
    document.getElementById('cancelEditBtn').style.display = 'inline-block';
    window.scrollTo(0, 0);
}

function deleteEntry(index) {
    if(confirm('Delete this entry?')) {
        billingEntries.splice(index, 1);
        saveToStorage();
        updateBillingTable();
        populateMonthFilter();
    }
}

function filterTable() {
    const search = document.getElementById('searchInput').value.toLowerCase();
    const month = document.getElementById('monthFilter').value;
    updateBillingTable(search, month);
}

function updateBillingTable(search = '', month = '') {
    const tbody = document.querySelector("#billingTable tbody");
    tbody.innerHTML = "";
    const filtered = billingEntries.filter(e => 
        e.company.toLowerCase().includes(search) && (!month || e.month === month)
    );

    filtered.forEach((entry, idx) => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${entry.company}</td>
            <td>${new Date(entry.month + '-01').toLocaleString('default', { month: 'short', year: 'numeric' })}</td>
            <td>${entry.date}</td>
            <td>₨${entry.totalAmount.toFixed(2)}</td>
            <td>${entry.billedDays}</td>
            <td>₨${entry.perDay.toFixed(2)}</td>
            <td>₨${entry.billedAmount.toFixed(2)}</td>
            <td>
                <button class="editBtn" onclick="editEntry(${billingEntries.indexOf(entry)})">Edit</button>
                <button class="deleteBtn" onclick="deleteEntry(${billingEntries.indexOf(entry)})">Delete</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

// CALCULATE TOTAL - PKR
document.getElementById("calculateBtn").addEventListener("click", () => {
    if(billingEntries.length === 0) return alert("No entries.");
    let total = billingEntries.reduce((sum, e) => sum + e.billedAmount, 0);
    const resultDiv = document.getElementById("billingResult");
    resultDiv.style.display = "block";
    resultDiv.innerHTML = `<strong>Total Billed Amount: </strong>₨${total.toFixed(2)} PKR`;
});

// EXPORT MENU
document.getElementById("exportBtn").addEventListener("click", () => {
    if(billingEntries.length === 0) return alert("No data to export.");
    const choice = prompt("Export as:\n1. Excel (.xlsx) - Stylish\n2. PDF (with Watermark)\n\nType 1 or 2:");
    if(choice === '1') exportExcel();
    else if(choice === '2') exportPDF();
});

// STYLISH EXCEL EXPORT
function exportExcel() {
    if (billingEntries.length === 0) return;

    const wb = XLSX.utils.book_new();

    const headerRows = [
        ["S.A Samad Enterprises Pvt LTD"],
        ["Professional Billing Invoice"],
        [""],
        ["Company", "Month", "Date", "Total Amount (PKR)", "Billed Days", "Per Day (PKR)", "Billed Amount (PKR)"]
    ];

    const dataRows = billingEntries.map(e => [
        e.company,
        new Date(e.month + '-01').toLocaleString('default', { month: 'long', year: 'numeric' }),
        e.date,
        e.totalAmount,
        e.billedDays,
        e.perDay,
        e.billedAmount
    ]);

    const total = billingEntries.reduce((s, e) => s + e.billedAmount, 0);
    dataRows.push(["", "", "", "", "", "TOTAL:", total]);

    const wsData = [...headerRows, ...dataRows];
    const ws = XLSX.utils.aoa_to_sheet(wsData);

    const range = XLSX.utils.decode_range(ws['!ref']);
    ws['!cols'] = [{ wch: 20 }, { wch: 15 }, { wch: 12 }, { wch: 18 }, { wch: 12 }, { wch: 15 }, { wch: 18 }];

    for (let R = 0; R <= range.e.r; ++R) {
        for (let C = 0; C <= range.e.c; ++C) {
            const cell_address = XLSX.utils.encode_cell({ r: R, c: C });
            if (!ws[cell_address]) continue;

            ws[cell_address].s = {
                font: { name: "Calibri", sz: 11 },
                alignment: { horizontal: "left", vertical: "center" }
            };

            if (R === 0) {
                ws[cell_address].s = { font: { name: "Calibri", sz: 16, bold: true, color: { rgb: "003E7E" } }, alignment: { horizontal: "center" } };
            }
            if (R === 1) {
                ws[cell_address].s = { font: { name: "Calibri", sz: 13, italic: true, color: { rgb: "0078D7" } }, alignment: { horizontal: "center" } };
            }
            if (R === 3) {
                ws[cell_address].s = {
                    font: { name: "Calibri", sz: 11, bold: true, color: { rgb: "FFFFFF" } },
                    fill: { fgColor: { rgb: "003E7E" } },
                    alignment: { horizontal: "center" },
                    border: { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } }
                };
            }
            if (R >= 4 && R < dataRows.length + 3) {
                ws[cell_address].s.border = { top: { style: "thin" }, bottom: { style: "thin" }, left: { style: "thin" }, right: { style: "thin" } };
                if ([3, 5, 6].includes(C)) {
                    ws[cell_address].z = '"₨"#,##0.00';
                    ws[cell_address].s.font = { bold: true };
                }
            }
            if (R === dataRows.length + 3) {
                ws[cell_address].s = { font: { bold: true, color: { rgb: "003E7E" } }, fill: { fgColor: { rgb: "EAF1FB" } }, border: { top: { style: "double" } } };
                if (C === 6) ws[cell_address].z = '"₨"#,##0.00';
            }
        }
    }

    ws['!merges'] = [
        { s: { r: 0, c: 0 }, e: { r: 0, c: 6 } },
        { s: { r: 1, c: 0 }, e: { r: 1, c: 6 } }
    ];

    // WATERMARK
    const wm = XLSX.utils.encode_cell({ r: 8, c: 2 });
    if (!ws[wm]) ws[wm] = { v: "S.A SAMAD" };
    ws[wm].s = { font: { sz: 48, color: { rgb: "CCCCCC" }, bold: true, italic: true }, alignment: { wrapText: true }, rotation: 45 };

    XLSX.utils.book_append_sheet(wb, ws, "Invoice");
    XLSX.writeFile(wb, "Samad_Enterprises_Invoice_PKR_Styled.xlsx");
}

// PDF EXPORT
function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    
    doc.setFontSize(40);
    doc.setTextColor(240, 240, 240);
    doc.text("S.A SAMAD", 50, 150, { angle: 45 });

    doc.setTextColor(0, 0, 0);
    doc.setFontSize(20);
    doc.text("S.A Samad Enterprises Pvt LTD", 105, 20, { align: "center" });
    doc.setFontSize(16);
    doc.text("Invoice (PKR)", 105, 30, { align: "center" });

    const rows = billingEntries.map(e => [
        e.company, e.month, e.date, `₨${e.totalAmount.toFixed(2)}`, e.billedDays, `₨${e.perDay.toFixed(2)}`, `₨${e.billedAmount.toFixed(2)}`
    ]);
    doc.autoTable({
        head: [["Company","Month","Date","Total (PKR)","Days","Per Day (PKR)","Billed (PKR)"]],
        body: rows,
        startY: 40,
        theme: 'grid'
    });

    const total = billingEntries.reduce((s,e) => s + e.billedAmount, 0);
    doc.setFontSize(14);
    doc.text(`Total: ₨${total.toFixed(2)} PKR`, 150, doc.lastAutoTable.finalY + 15);

    doc.save("Samad_Invoice_PKR.pdf");
}

// LOAD FROM EXCEL
document.getElementById("loadFile").addEventListener("change", function(e){
    const file = e.target.files[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = function(e){
        const data = new Uint8Array(e.target.result);
        const workbook = XLSX.read(data, {type:'array'});
        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
        const jsonData = XLSX.utils.sheet_to_json(firstSheet,{header:1});
        billingEntries = jsonData.slice(3).map(row => ({
            company: row[0] || "",
            month: row[1] || "",
            date: row[2] || "",
            totalAmount: parseFloat(row[3]) || 0,
            billedDays: parseInt(row[4]) || 0,
            perDay: parseFloat(row[5]) || 0,
            billedAmount: parseFloat(row[6]) || 0,
            totalDays: 30
        })).filter(e => e.company);
        saveToStorage();
        updateBillingTable();
        populateMonthFilter();
        alert("Entries loaded successfully!");
    }
    reader.readAsArrayBuffer(file);
});

// DARK MODE
function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
}
if(localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');
</script>

</body>
</html>